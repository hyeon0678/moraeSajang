<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.morae.message.dao.MessageDao">
	
	<select id="nameCheck" resultType="String">
		select userId from user where nickname = #{param1};
	</select>
		
	<select id="nickNameId" resultType="String">
		select userId from user where nickname = #{param1};
	</select>
	
	<insert id="msgSend" parameterType="Map">
		INSERT INTO messages (messageContent,sentDate,messageRead,sener,reciever)
			VALUES (#{param1}, now(), 'N', #{param2}, #{param3});
	</insert>
	
	<select id="list" resultType="kr.co.morae.message.dto.MessageDto">
		select messagesNo, SUBSTRING(messageContent, 1, 20) as messageContent,
			sentDate, messageRead, sener from messages
				where reciever = #{param1} order by messagesNo desc limit 5 offset #{param2};
	</select>
	
	<select id="totalPage" resultType="int">
		select ceil(count(messagesNo)/5) as pages from messages;
	</select>
	
</mapper>